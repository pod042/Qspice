ÿØÿÛ«schematic
  «component (-11500,-9700) 0 0
    «symbol V
      «type: V»
      «description: Independent Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (100,150) 1 7 0 0x1000000 -1 -1 "V1"»
      «text (250,-150) 1 7 0 0x1000000 -1 -1 "sin 0 1 1K"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «component (-12000,-9700) 0 0
    «symbol B1
      «type: B»
      «description: Behavioral Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (100,150) 1 7 0 0x1000000 -1 -1 "B1"»
      «text (-2900,0) 1 7 0 0x1000000 -1 -1 "V=Vo/100 + 0.05*(1 - random(time))"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «component (-13500,-8100) 0 0
    «symbol V
      «type: V»
      «description: Independent Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (100,150) 1 7 0 0x1000000 -1 -1 "V2"»
      «text (100,-150) 1 7 0 0x1000000 -1 -1 "Vo/100"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «component (-9800,-8300) 0 0
    «symbol
      «type: Ø(.DLL)»
      «shorted pins: false»
      «rect (-600,-1600) (2100,900) 0 0 0 0x4000000 0x4000000 -1 1 -1»
      «text (750,350) 1 12 0 0x1000000 -1 -1 "X1"»
      «text (750,250) 0.681 13 0 0x1000000 -1 -1 "digital_controller"»
      «text (770,-270) 0.681 13 0 0x1000000 -1 -1 "double fs = fs"»
      «text (910,-400) 0.681 13 0 0x1000000 -1 -1 "double fclk = 200e6"»
      «text (820,-530) 0.681 13 0 0x1000000 -1 -1 "double kpi = kpi"»
      «text (780,-650) 0.681 13 0 0x1000000 -1 -1 "double kii = kii"»
      «text (840,-770) 0.681 13 0 0x1000000 -1 -1 "double kpv = kpv"»
      «text (810,-890) 0.681 13 0 0x1000000 -1 -1 "double kiv = kiv"»
      «text (870,-1010) 0.681 13 0 0x1000000 -1 -1 "double tdead = 10e-9"»
      «text (920,-1130) 0.681 13 0 0x1000000 -1 -1 "int carrier_mode = 0"»
      «text (940,-1250) 0.681 13 0 0x1000000 -1 -1 "int sample_mode = 1"»
      «pin (-600,600) (100,0) 1 7 145 0x0 -1 "v_ref"»
      «pin (-600,100) (100,0) 1 7 145 0x0 -1 "vline_sense"»
      «pin (-600,-400) (100,0) 1 7 145 0x0 -1 "Vo_sense"»
      «pin (-600,-900) (100,0) 1 7 145 0x0 -1 "IL_sense"»
      «pin (2100,600) (-50,0) 1 11 146 0x0 -1 "duty"»
      «pin (2100,100) (-50,0) 1 11 146 0x0 -1 "Shigh"»
      «pin (2100,-400) (-50,0) 1 11 146 0x0 -1 "Slow"»
      «pin (2100,-1500) (-50,0) 1 11 146 0x0 -1 "debug"»
    »
  »
  «component (-12700,-8600) 0 0
    «symbol B1
      «type: B»
      «description: Behavioral Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (-400,0) 1 7 0 0x1000000 -1 -1 "B2"»
      «text (-10800,-250) 1 7 0 0x1000000 -1 -1 "V=if(time < 7.75/line_freq, Vline_rms*sqrt(2)*0.01*sin(time*2*pi*line_freq), Vline_rms*sqrt(2)*0.01*sin(time*2*pi*line_freq + pi))"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «component (-4400,-8800) 0 0
    «symbol B1
      «type: B»
      «description: Behavioral Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (100,150) 1 7 0 0x1000000 -1 -1 "B3"»
      «text (100,-150) 1 7 0 0x1000000 -1 -1 "V=V(vbase)/(Vline_rms*sqrt(2)*0.01) - V(debug)"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «component (-12100,-8200) 6 0
    «symbol B1
      «type: B»
      «description: Behavioral Voltage Source»
      «shorted pins: false»
      «line (0,-130) (0,-200) 0 0 0x1000000 -1 -1»
      «line (0,200) (0,130) 0 0 0x1000000 -1 -1»
      «rect (-25,77) (25,73) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-2,50) (2,100) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «rect (-25,-73) (25,-77) 0 0 0 0x1000000 0x3000000 -1 0 -1»
      «ellipse (-130,130) (130,-130) 0 0 0 0x1000000 0x1000000 -1 -1»
      «text (-130,0) 1 46 0 0x1000000 -1 -1 "B4"»
      «text (130,-5150) 1 45 0 0x1000000 -1 -1 "V=0.3*sin(2*pi*time*180) + 0.1*sin(2*pi*time*300) + 0.03*sin(2*pi*time*1e3)"»
      «pin (0,200) (0,0) 1 0 0 0x0 -1 "+"»
      «pin (0,-200) (0,0) 1 0 0 0x0 -1 "-"»
    »
  »
  «net (-12700,-9100) 1 13 0 "GND"»
  «net (-7300,-7700) 1 14 0 "d"»
  «net (-7300,-8200) 1 14 0 "sh"»
  «net (-7300,-8700) 1 14 0 "sl"»
  «net (-11500,-10100) 1 13 0 "GND"»
  «net (-12000,-10100) 1 13 0 "GND"»
  «net (-13500,-8400) 1 13 0 "GND"»
  «net (-7200,-9800) 1 7 0 "debug"»
  «net (-11200,-8200) 1 14 0 "vline"»
  «net (-12700,-8200) 1 14 0 "vbase"»
  «net (-4400,-8200) 1 14 0 "error"»
  «net (-4400,-9100) 1 13 0 "GND"»
  «wire (-7300,-8700) (-7000,-8700) "sl"»
  «wire (-7000,-8700) (-7000,-9200) "sl"»
  «wire (-7300,-8200) (-6200,-8200) "sh"»
  «wire (-6200,-8200) (-6200,-9200) "sh"»
  «wire (-7300,-7700) (-5400,-7700) "d"»
  «wire (-5400,-7700) (-5400,-9200) "d"»
  «wire (-7700,-7700) (-7300,-7700) "d"»
  «wire (-7700,-8200) (-7300,-8200) "sh"»
  «wire (-7700,-8700) (-7300,-8700) "sl"»
  «wire (-11500,-10100) (-11500,-9900) "GND"»
  «wire (-11500,-9500) (-11500,-9200) "N01"»
  «wire (-11500,-9200) (-10400,-9200) "N01"»
  «wire (-12700,-8800) (-12700,-9100) "GND"»
  «wire (-12700,-8400) (-12700,-8200) "vbase"»
  «wire (-12000,-9900) (-12000,-10100) "GND"»
  «wire (-12000,-9500) (-12000,-8700) "N02"»
  «wire (-12000,-8700) (-10400,-8700) "N02"»
  «wire (-11200,-8200) (-10400,-8200) "vline"»
  «wire (-13500,-8300) (-13500,-8400) "GND"»
  «wire (-13500,-7900) (-13500,-7700) "N03"»
  «wire (-13500,-7700) (-10400,-7700) "N03"»
  «wire (-7700,-9800) (-7200,-9800) "debug"»
  «wire (-11900,-8200) (-11200,-8200) "vline"»
  «wire (-12700,-8200) (-12300,-8200) "vbase"»
  «wire (-4400,-9000) (-4400,-9100) "GND"»
  «wire (-4400,-8600) (-4400,-8200) "error"»
  «wire (-4400,-8200) (-3700,-8200) "error"»
  «rect (-14200,-2800) (-12350,-5300) 0 0 2 0x4000000 0x1000000 -1 0 -1»
  «rect (-12000,-2800) (-9250,-5300) 0 0 2 0x4000000 0x1000000 -1 0 -1»
  «rect (-9000,-2800) (-4900,-5300) 0 0 2 0x4000000 0x1000000 -1 0 -1»
  «rect (-17050,-2750) (-15100,-5250) 0 0 2 0x4000000 0x1000000 -1 0 -1»
  «text (-13450,-7100) 1 7 0 0x1000000 -1 -1 "ï»¿.tran 24/line_freq"»
  «text (-8850,-3000) 1.25 7 1 0x1000000 -1 -1 "ï»¿Simulation prompts"»
  «text (-14100,-3000) 1.25 7 1 0x1000000 -1 -1 "ï»¿Design parameters"»
  «text (-11850,-3000) 1.25 7 1 0x1000000 -1 -1 "ï»¿Simulation parameters"»
  «text (-11850,-3300) 1 7 0 0x1000000 -1 -1 "ï»¿.param Vline_rms = 220"»
  «text (-11850,-3550) 1 7 0 0x1000000 -1 -1 "ï»¿.param line_freq = 60"»
  «text (-11850,-3900) 1 7 0 0x1000000 -1 -1 "ï»¿.param Po = 300\n.param Ro = Vo**2 / Po"»
  «text (-14100,-3300) 1 7 0 0x1000000 -1 -1 "ï»¿.param Vo = 380"»
  «text (-14100,-3600) 1 7 0 0x1000000 -1 -1 "ï»¿.param Lb = 2.4m"»
  «text (-14100,-3900) 1 7 0 0x1000000 -1 -1 "ï»¿.param Co = 270Âµ"»
  «text (-14100,-4200) 1 7 0 0x1000000 -1 -1 "ï»¿.param fs = 64.8K"»
  «text (-14100,-4500) 1 7 0 0x1000000 -1 -1 "ï»¿.param Rs = 30m"»
  «text (-14100,-4800) 1 7 0 0x1000000 -1 -1 "ï»¿.param Td = 10n"»
  «text (-11850,-4250) 1 7 0 0x1000000 -1 -1 "ï»¿.param tend = 0.1"»
  «text (-11850,-4500) 1 7 0 0x1000000 -1 -1 "ï»¿.param tmeas = tend - 4/line_freq"»
  «text (-11850,-4750) 1 7 0 0x1000000 -1 -1 "ï»¿.param Rline = 10m"»
  «text (-11850,-5000) 1 7 0 0x1000000 -1 -1 "ï»¿.param Lline = 10Âµ"»
  «text (-16950,-2950) 1.25 7 1 0x1000000 -1 -1 "ï»¿Control parameters"»
  «text (-16900,-3250) 1 7 0 0x1000000 -1 -1 "ï»¿.param kpi = 2.3579"»
  «text (-16170,-3490) 1 15 0 0x1000000 -1 -1 "ï»¿.param kii = -0.5283*kpi"»
  «text (-16160,-3750) 1 15 0 0x1000000 -1 -1 "ï»¿.param kpv = 0.33753"»
  «text (-16100,-4000) 1 15 0 0x1000000 -1 -1 "ï»¿.param kiv = -0.9986*kpv"»
  «text (-6350,-6350) 1 7 0 0x1000000 -1 -1 "ï»¿.plot V(vline)"»
  «text (-6350,-6600) 1 7 0 0x1000000 -1 -1 "ï»¿.plot V(vbase), V(debug)"»
  «text (-6350,-6850) 1 7 0 0x1000000 -1 -1 "ï»¿.plot V(error)"»
»

